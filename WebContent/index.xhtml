<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"> 

<h:head>
	
</h:head> 
<body>
	
	<h1>PDV</h1>
	<h:form id="formEstoque">
		<h:commandLink action="controle?faces-redirect=true" 
		value="Controle" />
		
		 <p:dataTable var="produto" value="#{pdvBean.produtos}" widgetVar="estoque"
                 emptyMessage="Não foi encontrado o produto..." filteredValue="#{pdvBean.produtosFiltrados}" 
                 paginator="true" rows="5" rowsPerPageTemplate="2,5,10">
                 
                 <f:facet name="header">
		            <p:outputPanel>
		                <h:outputText value="Procure em todos os campos:" />
		                <p:inputText id="globalFilter" onkeyup="PF('estoque').filter()" style="width:230px" placeholder="Digite para buscar..."/>
		            </p:outputPanel>
	        	</f:facet>
	        	
	        	<p:column filterBy="#{produto.codigo}" headerText="COD" footerText="contains" filterMatchMode="contains">
            		<h:outputText value="#{produto.codigo}" />
        		</p:column>
	        	
	        	<p:column filterBy="#{produto.descricao}" headerText="Descirção" footerText="contains" filterMatchMode="contains">
            		<h:outputText value="#{produto.descricao}" />
        		</p:column>
        		
        		<p:column filterBy="#{produto.nome}" headerText="Nome" footerText="contains" filterMatchMode="contains">
            		<h:outputText value="#{produto.nome}" />
        		</p:column>
        		
        		<p:column filterBy="#{produto.quantidade}" headerText="QTD" footerText="contains" filterMatchMode="contains">
            		<h:outputText value="#{produto.quantidade}" />
        		</p:column>
        		
        		<p:column filterBy="#{produto.preco}" headerText="Preco" footerText="contains" filterMatchMode="contains">
            		<h:outputText value="#{produto.preco}" />
        		</p:column>
        		
        		<p:column headerText="ADD" footerText="contains">
            		<p:commandButton value="Add" action="#{pdvBean.AddCarrinho(produto)}" update="formEstoque, :formCarrinho" process="@form"/>
        		</p:column>
                 
         </p:dataTable>
 
	</h:form>
	<br/>
	<h:form id="formCarrinho">
		<p:dataTable var="item" value="#{pdvBean.itensVenda}" widgetVar="carrinho"
              paginator="true" rows="5" rowsPerPageTemplate="2,5,10">
                 
                 <f:facet name="header">
		            <p:outputPanel>
		                <h:outputText value="Carrinho" />
		            </p:outputPanel>
	        	</f:facet>
	        	
	        	<p:column headerText="COD" footerText="contains">
            		<h:outputText value="#{item.produto.codigo}" />
        		</p:column>
	        	
	        	<p:column headerText="Decrição" footerText="contains">
            		<h:outputText value="#{item.produto.descricao}" />
        		</p:column>
        		
        		<p:column headerText="Quantidade" footerText="contains">
            		<p:spinner id="ajaxSpinnerQtd" value="#{item.quantidade}" min="1" max="#{item.produto.quantidade}" size="5">
                		<p:ajax update="ajaxSpinnerValue, formCarrinho" process="@this" />
            		</p:spinner>
        		</p:column>
        		
        		<p:column headerText="Preço Unitário" footerText="contains">
            		<p:spinner id="ajaxSpinnerPreco" value="#{item.valorUnitario}" prefix="R$" stepFactor="0.10" size="8">
                		<p:ajax update="ajaxSpinnerValue, formCarrinho" process="@this" />
            		</p:spinner>
        		</p:column>
        		
        		<p:column headerText="Total/item" footerText="contains">
            		<h:outputText id="ajaxSpinnerValue" value="R$ #{item.totalItem}" />
        		</p:column>
        		
        		 <f:facet name="footer">
        		 	<h:outputText id="ajaxSpinnerValueTotal" value="Total: R$ #{pdvBean.valorTotal(pdvBean.itensVenda)}" />
    			</f:facet>
	        	
        </p:dataTable>
		
		<p:commandButton value="Finalizar Compra" type="button" onclick="PF('dlg2').show();"/>
		<p:commandButton value="Cancelar Compra"/>
		
		<p:dialog header="Modal Dialog" widgetVar="dlg2" modal="true">
    		
			<h:panelGrid columns="2">
				
				<p:outputLabel value="Data da Venda"/>
				<p:clock pattern="dd.MM.yyyy - HH:mm:ss"/>
				
				<p:outputLabel value="CPF " for="cpf"/>
				<p:inputMask  id="cpf" value="#{pdvBean.venda.cpfCliente}" required="true" requiredMessage="Nome Obrigatório" mask="999.999.999-99"/>
				
			</h:panelGrid>
			
			<br/>
			
    		<p:dataTable var="item" value="#{pdvBean.itensVenda}" widgetVar="carrinho"
              paginator="true" rows="5" rowsPerPageTemplate="2,5,10">
                 
                <f:facet name="header">
		            <p:outputPanel>
		                <h:outputText value="Carrinho" />
		            </p:outputPanel>
	        	</f:facet>
	        	
	        	<p:column headerText="COD" footerText="contains">
            		<h:outputText value="#{item.produto.codigo}" />
        		</p:column>
	        	
	        	<p:column headerText="Decrição" footerText="contains">
            		<h:outputText value="#{item.produto.descricao}" />
        		</p:column>
        		
        		<p:column headerText="Quantidade" footerText="contains">
            		<p:spinner id="ajaxSpinnerQtd" value="#{item.quantidade}" min="1" max="#{item.produto.quantidade}" size="5">
                		<p:ajax update="ajaxSpinnerValue, formCarrinho" process="@this" />
            		</p:spinner>
        		</p:column>
        		
        		<p:column headerText="Preço Unitário" footerText="contains">
            		<p:spinner id="ajaxSpinnerPreco" value="#{item.valorUnitario}" prefix="R$" stepFactor="0.10" size="8">
                		<p:ajax update="ajaxSpinnerValue, formCarrinho" process="@this" />
            		</p:spinner>
        		</p:column>
        		
        		<p:column headerText="Total/item" footerText="contains">
            		<h:outputText id="ajaxSpinnerValue" value="R$ #{item.totalItem}" />
        		</p:column>
        		
        		<f:facet name="footer">
        		 	<h:outputText id="ajaxSpinnerValueTotal" value="Total: R$ #{pdvBean.valorTotal(pdvBean.itensVenda)}" />
    			</f:facet>
	        	
        	</p:dataTable>
        	
        	<h:panelGrid columns="2" style="margin-bottom:10px" cellpadding="5">
		        <p:outputLabel for="opPagamento" value="Tipo de Pagamento: " />
		        <p:selectOneMenu id="opPagamento" value="#{pdvBean.venda.pagamento.tipo}" style="width:125px">
		            <f:selectItem itemLabel="Selecione Um..." itemValue="" />
		            <f:selectItem itemLabel="#{pdvBean.tipoCartão}" itemValue="Cartão" />
		            <f:selectItem itemLabel="#{pdvBean.tipoDinheiro}" itemValue="Dinheiro" /> 
		        </p:selectOneMenu>
        	</h:panelGrid>
        	
		</p:dialog>		
	</h:form>
	
	
</body> 
</html>
